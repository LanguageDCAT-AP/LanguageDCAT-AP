@prefix :           <https://language-data-space.eu/entity/> .
@prefix sh:         <http://www.w3.org/ns/shacl#> . # OK
@prefix edc:        <https://w3id.org/edc/v0.0.1/ns/> . # OK
@prefix loc:        <http://id.loc.gov/vocabulary/iso639-1/> . # TODO
@prefix iana:       <http://www.iana.org/assignments/media-types/application/> . # TODO
@prefix lds:        <https://language-data-space.eu/entity/> .
@prefix adms:       <http://www.w3.org/ns/adms#> . # OK
@prefix euvoc_auth: <http://publications.europa.eu/resource/authority/>  . # OK
@prefix dcat:       <http://www.w3.org/ns/dcat#> . # OK
@prefix dcmitype:   <http://purl.org/dc/dcmitype/> . # OK
@prefix dct:        <http://purl.org/dc/terms/> . # OK
@prefix foaf:       <http://xmlns.com/foaf/0.1/> . # OK
@prefix ms:         <http://w3id.org/meta-share/meta-share/> . # OK
@prefix odrl:       <http://www.w3.org/ns/odrl/2/> . # OK
@prefix omtd:       <http://w3id.org/meta-share/omtd-share/> . # OK
@prefix owl:        <http://www.w3.org/2002/07/owl#> . # OK
@prefix rdf:        <http://www.w3.org/1999/02/22-rdf-syntax-ns#> . # OK
@prefix rdfs:       <http://www.w3.org/2000/01/rdf-schema#> . # OK
@prefix schema:     <https://schema.org/> . # OK
@prefix skos:       <http://www.w3.org/2004/02/skos/core#> . # OK
@prefix xsd:        <http://www.w3.org/2001/XMLSchema#> . # OK


sh:ToolServiceShape
    a                    sh:NodeShape ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:targetClass       edc:Asset ;
    # Common Properties
    sh:property          sh:LrTypePropCRD, sh:LrTypePropVal, sh:TitleProp, sh:AlternativeProp, sh:DescriptionProp,
                         sh:DomainProp, sh:IprHolderProp, sh:DocumentedByProp, sh:AdmsIdentifierProp, sh:KeywordProp,
                         sh:VersionProp ;
    sh:property          sh:TSFunctionProp, sh:LanguageDependentProp, sh:InputContentResourceProp,
                         sh:OutputContentResourceProp, sh:SoftwareDistributionProp ;
    sh:sparql [
                  a sh:SPARQLConstraint ;
                  sh:message "Asset specified as language dependent (ms:languageDependent: true). At least one ms:language must be provided in ms:inputContentResource and ms:outputResource (if provided)." ;
                  sh:select """
                        SELECT $this
                        WHERE {
                            $this <http://w3id.org/meta-share/meta-share/languageDependent> true .
                            FILTER NOT EXISTS {
                                { $this <http://w3id.org/meta-share/meta-share/inputContentResource>/<http://w3id.org/meta-share/meta-share/language> ?lang }
                            }
                        }
                  """ ;
              ] .

## Prop definitions
sh:TSFunctionProp
    a           sh:PropertyShape ;
    sh:path     ms:function ;
    sh:node     sh:TSFunctionRestriction ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 .

sh:LanguageDependentProp
    a           sh:PropertyShape ;
    sh:path     ms:languageDependent ;
    sh:datatype xsd:boolean ;
    sh:minCount 1 ;
    sh:maxCount 1 .

sh:InputContentResourceProp
    a           sh:PropertyShape ;
    sh:path     ms:inputContentResource ;
    sh:class    ms:ProcessingResource ;
    sh:minCount 1 .

sh:OutputContentResourceProp
    a        sh:PropertyShape ;
    sh:path  ms:outputResource ;
    sh:class ms:ProcessingResource .

sh:SoftwareDistributionProp
    a        sh:PropertyShape ;
    sh:path  ms:softwareDistribution ;
    sh:class ms:SoftwareDistribution ;
    sh:minCount 1 ;
    sh:maxCount 1 .

# ProcessingResource

sh:ProcessingResourceTypeProp
    a           sh:PropertyShape ;
    sh:path     ms:processingResourceType ;
    sh:node     sh:ProcessingResourceTypeRestriction ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 ;
    sh:maxCount 1 .

sh:DCTFormatProp
    a           sh:PropertyShape ;
    sh:path     dct:format ;
    sh:node     sh:DataFormatRestriction ;
    sh:nodeKind sh:IRI .

sh:OptLanguageProp
    a sh:PropertyShape   ;
    sh:path         ms:language ;
    sh:property     [
          sh:path         ms:languageCode;
          sh:node         sh:LanguageRestriction ;
          sh:nodeKind     sh:IRI ;
          sh:minCount 1;
          sh:maxCount 1;
          sh:message  "Invalid language"@en ;
      ],
    [
          sh:path         ms:region ;
          sh:node         sh:LocationRestriction ;
          sh:nodeKind     sh:IRI ;
          sh:maxCount 1;
      ],
    [
          sh:path         ms:script ;
          sh:node         sh:ScriptRestriction ;
          sh:nodeKind     sh:IRI ;
          sh:maxCount 1;
      ],
    [
          sh:path         ms:variant ;
          sh:node         sh:VariantRestriction ;
          sh:nodeKind     sh:IRI ;
      ],
    [
          sh:path         ms:languageVarietyName ;
          sh:datatype     rdf:langString ;
          sh:uniqueLang     true;
      ] .

sh:MediaTypePropOpt
    a sh:PropertyShape ;
    sh:path         ms:mediaType ;
    sh:node         sh:MediaTypeRestriction  ;
    sh:nodeKind     sh:IRI ;
    sh:message "Invalid media type" .

# SoftwareDistribution

sh:SoftwareDistributionFormProp
    a           sh:PropertyShape ;
    sh:path     ms:softwareDistributionForm ;
    sh:node     sh:SoftwareDistributionFormRestriction ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 ;
    sh:maxCount 1 .


sh:ExecutionLocationProp
    a           sh:PropertyShape ;
    sh:path     ms:executionLocation ;
    sh:datatype xsd:anyURI ;
    sh:maxCount 1 .

sh:DownloadLocationProp
    a           sh:PropertyShape ;
    sh:path     ms:downloadLocation ;
    sh:datatype xsd:anyURI ;
    sh:maxCount 1 .

sh:AccessLocationProp
    a           sh:PropertyShape ;
    sh:path     ms:accessLocation ;
    sh:datatype xsd:anyURI ;
    sh:maxCount 1 .

## Node definitions
# ProcessingResource
sh:ProcessingResourceShape
    a                    sh:NodeShape ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:targetClass       ms:ProcessingResource ;
    sh:property          sh:ProcessingResourceTypeProp, sh:OptLanguageProp, sh:MediaTypePropOpt, sh:DCTFormatProp .

# SoftwareDistribution
sh:SoftwareDistributionShape
    a                    sh:NodeShape ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:targetClass       ms:SoftwareDistribution ;
    sh:property          sh:ExecutionLocationProp, sh:DownloadLocationProp, sh:AccessLocationProp .

## Restrictions

sh:TSFunctionRestriction
    a            sh:NodeShape ;
    rdfs:comment "Tool/Service Function Restriction" ;
    rdfs:label   "Tool/Service Function Restriction" ;
    sh:property  [ sh:hasValue omtd:OperationScheme ;
                   sh:nodeKind sh:IRI ;
                   sh:path     skos:inScheme ; ] .


sh:ProcessingResourceTypeRestriction
    a            sh:NodeShape ;
    rdfs:comment "Processing Resource Type Restriction" ;
    rdfs:label   "Processing Resource Type Restriction" ;
    sh:property  [ sh:hasValue ms:ProcessingResourceTypeTaxonomy ;
                   sh:nodeKind sh:IRI ;
                   sh:path     skos:inScheme ; ] .

sh:SoftwareDistributionFormRestriction
    a            sh:NodeShape ;
    rdfs:comment "Software Distribution Form Restriction" ;
    rdfs:label   "Software Distribution Form Restriction" ;
    sh:property  [ sh:hasValue ms:SoftwareDistributionFormTaxonomy ;
                   sh:nodeKind sh:IRI ;
                   sh:path     skos:inScheme ; ] .


